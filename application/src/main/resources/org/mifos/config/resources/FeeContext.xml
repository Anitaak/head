<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:sec="http://www.springframework.org/schema/security"
    xmlns:context="http://www.springframework.org/schema/context" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation=" http://www.springframework.org/schema/beans classpath:xsd/spring-beans-3.0.xsd
      http://www.springframework.org/schema/security classpath:xsd/spring-security-3.0.xsd
      http://www.springframework.org/schema/tx
      http://www.springframework.org/schema/tx/spring-tx-3.0.xsd
      http://www.springframework.org/schema/context
      http://www.springframework.org/schema/context/spring-context-3.0.xsd
      http://www.springframework.org/schema/aop
      http://www.springframework.org/schema/aop/spring-aop-3.0.xsd">
      
  	<context:annotation-config/>  
  	
  	<import resource="mainPropertyConfigurer.xml" />
  	<!--  <bean id="propertyConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="location" value="/mainDatabase.properties"/>
    </bean>
    -->
    
    <bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource">
    	<property name="driverClass" value="${main.database.driver}"/> 
    	<property name="jdbcUrl" value="jdbc:mysql://${main.database.host}:${main.database.port}/${main.database}" />
    	<property name="user" value="${main.database.user}"/>
    	<property name="password" value="${main.database.password}"/>
    	<property name="initialPoolSize" value="5"></property>
    	<property name="minPoolSize" value="${main.database.hibernate.c3p0.min_size}"/>
    	<property name="maxPoolSize" value="${main.database.hibernate.c3p0.max_size}"/>
    	<property name="checkoutTimeout" value="${main.database.hibernate.c3p0.timeout}"/> 
    	<property name="maxStatements" value="${main.database.hibernate.c3p0.max_statements}"></property>
    	<property name="testConnectionOnCheckout" value="false"/>
    	<property name="idleConnectionTestPeriod" value="${main.database.hibernate.c3p0.idle_test_period}"></property> 
   	</bean>
    
    <!--  <bean id="sessionFactory" class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">  -->
	<bean id="sessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="mappingResources">
			<list>
				<value>/org/mifos/accounts/fees/business/FeeStatusEntity.hbm.xml</value>
				<value>/org/mifos/accounts/fees/business/CategoryTypeEntity.hbm.xml</value>
				<value>/org/mifos/accounts/fees/business/FeeFrequencyTypeEntity.hbm.xml</value>
				<value>/org/mifos/accounts/fees/business/FeeFormulaEntity.hbm.xml</value>
				<value>/org/mifos/accounts/fees/business/FeePaymentEntity.hbm.xml</value>
				
				<value>/org/mifos/customers/office/business/OfficeBO.hbm.xml</value>
				<value>/org/mifos/customers/office/business/OfficeCustomFieldEntity.hbm.xml</value>
				<value>/org/mifos/customers/office/business/OfficeAddressEntity.hbm.xml</value>
				<value>/org/mifos/customers/office/business/OfficeLevelEntity.hbm.xml</value>
				<value>/org/mifos/customers/office/business/OfficeStatusEntity.hbm.xml</value>
				
				<value>/org/mifos/application/master/business/LookUpValueEntity.hbm.xml</value>
				<value>/org/mifos/application/master/business/LookUpValueLocaleEntity.hbm.xml</value>
				<value>/org/mifos/application/master/business/LookUpLabelEntity.hbm.xml</value>
				<value>/org/mifos/application/master/business/SupportedLocalesEntity.hbm.xml</value>
				<value>/org/mifos/application/master/business/LanguageEntity.hbm.xml</value>
				
				<value>/org/mifos/application/meeting/business/MeetingBO.hbm.xml</value>
				<value>/org/mifos/application/meeting/business/MeetingDetailsEntity.hbm.xml</value>
				<value>/org/mifos/application/meeting/business/MeetingRecurrenceEntity.hbm.xml</value>
				<value>/org/mifos/application/meeting/business/MeetingTypeEntity.hbm.xml</value>
				<value>/org/mifos/application/meeting/business/RecurrenceTypeEntity.hbm.xml</value>
				<value>/org/mifos/application/holiday/business/HolidayBO.hbm.xml</value>
				
				<value>/org/mifos/accounts/financial/business/COABO.hbm.xml</value>
				<value>/org/mifos/accounts/financial/business/COAHierarchyEntity.hbm.xml</value>
			</list>
		</property>
		
		<property name="annotatedClasses">
     		<list>
     			<value>org.mifos.accounts.fees.entities.FeeEntity</value>
     			<value>org.mifos.accounts.fees.entities.FeeLevelEntity</value>
     			<value>org.mifos.accounts.fees.entities.FeeFrequencyEntity</value>
     			<value>org.mifos.accounts.fees.entities.RateFeeEntity</value>
     			<value>org.mifos.accounts.fees.entities.AmountFeeEntity</value>
       			<value>org.mifos.accounts.financial.business.GLCodeEntity</value>
       			<value>org.mifos.application.master.business.LookUpEntity</value>
       			<value>org.mifos.application.master.business.CountryEntity</value>
	     	</list>
     	</property>
		<!--  <property name = "packagesToScan" value="org.mifos.accounts.fees.servicefacade.entities" />  -->
		<property name="hibernateProperties">
			<value>
				hibernate.dialect=${main.database.hibernate.dialect}
				hibernate.show_sql=${main.database.hibernate.show_sql}
				hibernate.generate_statistics=false
				hibernate.format_sql=false
				hibernate.use_sql_comments=false
				hibernate.cache.use_query_cache=${main.database.hibernate.cache.use_query_cache}
				hibernate.cache.use_second_level_cache=${main.database.hibernate.cache.use_second_level_cache}
				hibernate.connection.provider_class=${main.database.hibernate.connection.provider_class}
			</value>
	  </property>
    </bean>
	
	<bean id="platformTransactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">        
 		<property name="sessionFactory">            
 			<ref local="sessionFactory" />        
		</property>    
	</bean>
	
	<tx:advice id="txAdvice" transaction-manager="platformTransactionManager">
		<tx:attributes>
			<!-- all methods starting with 'get', 'find', 'list', 'iterate', 'retrieve' are read-only -->
			<tx:method name="get*" read-only="true"/>
          	<tx:method name="find*" read-only="true"/>
          	<tx:method name="list*" read-only="true"/>
          	<tx:method name="retrieve*" read-only="true"/>
          	<tx:method name="*" rollback-for="org.springframework.dao.DataAccessException"/>
			<!-- other methods use the default transaction settings (see below) -->
			<tx:method name="*"/>
		</tx:attributes>
	</tx:advice>
	<!-- ensure that the above transactional advice runs for any execution
		of an operation defined by the ServiceService interface -->
	<aop:config>
		<aop:pointcut id="mifosServiceOperation" expression="execution(* org.mifos..*ServiceFacade.*(..))"/>
		<aop:advisor advice-ref="txAdvice" pointcut-ref="mifosServiceOperation"/>
	</aop:config>
	<bean id="queryInterceptor" class="org.mifos.accounts.fees.persistence.QueryIntroductionInterceptor" />
	<bean id="queryIntroductionAdvisor" class="org.mifos.accounts.fees.persistence.QueryIntroductionAdvisor">
		<constructor-arg ref="queryInterceptor"/>
	</bean>
	<bean id="abstractDaoTarget"
        class="org.mifos.accounts.fees.persistence.GenericDaoHibernateImpl" abstract="true">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean>
    <bean id="abstractDao" class="org.springframework.aop.framework.ProxyFactoryBean" abstract="true">
    	<property name="interceptorNames">
            <list>
                <value>queryIntroductionAdvisor</value>
            </list>
        </property>
    </bean>

    <bean id="feeDao" parent="abstractDao">
       <property name="proxyInterfaces" value="org.mifos.accounts.fees.persistence.FeeDao"/>
       <property name="target">
           <bean parent="abstractDaoTarget">
              <constructor-arg><value>org.mifos.accounts.fees.entities.FeeEntity</value></constructor-arg>
           </bean>
       </property>
    </bean>
	<bean id="masterEntityDao" class="org.mifos.accounts.fees.persistence.MasterEntityDaoHibernateImpl">
		<property name="sessionFactory" ref="sessionFactory"/>
	</bean>
	<bean name="mifosApplicationContext" class="org.mifos.accounts.fees.servicefacade.MifosApplicationContext"/>
	
	
	
	
	<bean name="feeService" class="org.mifos.accounts.fees.servicefacade.FeeServiceImpl"/>
	<bean name="feeServiceFacade" class="org.mifos.accounts.fees.servicefacade.WebFeeServiceFacade"/>
    <!--
    <context:component-scan base-package="org.mifos.accounts.fees.servicefacade"/>
    -->
</beans>
