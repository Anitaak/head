<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >


<hibernate-mapping>

	<class name="org.mifos.application.holiday.business.HolidayBO" table="HOLIDAY">
        <id name="id" column="HOLIDAY_ID" type="int">
            <generator class="native"/>
        </id>
	    <property name="holidayFromDate" column="HOLIDAY_FROM_DATE" type="date" />
	    <property name="holidayThruDate" column="HOLIDAY_THRU_DATE" type="date" />
		<property name="holidayName" column="HOLIDAY_NAME" type="string" />
        <property name="repaymentRuleType" column="REPAYMENT_RULE_ID"
            type="org.mifos.application.holiday.util.helpers.RepaymentRuleUserType" not-null="true"/>
		<property name="holidayChangesAppliedFlag" column="HOLIDAY_CHANGES_APPLIED_FLAG"/>        
	</class>

	<!-- Holiday Specific Queries  -->
	<query name="holiday.getHolidays">
   	       <![CDATA[select holidayBO from org.mifos.application.holiday.business.HolidayBO holidayBO
                       where (holidayBO.holidayThruDate >= :START_OF_YEAR  and  holidayBO.holidayThruDate <= :END_OF_YEAR) 
		               or (holidayBO.holidayFromDate >= :START_OF_YEAR and  holidayBO.holidayFromDate <= :END_OF_YEAR)
                       order by holidayBO.holidayFromDate
   	       ]]>
	</query>
	<query name="holiday.getHoildaysByFlag">
			<![CDATA[from org.mifos.application.holiday.business.HolidayBO holidayBO
	                  where holidayBO.holidayChangesAppliedFlag = :FLAG
			]]>
	</query>
	
	
	<query name="holiday.getDistinctYears">
			<![CDATA[select distinct(holidayBO.holidayThruDate)
					from org.mifos.application.holiday.business.HolidayBO holidayBO
					order by holidayBO.holidayThruDate
   	       ]]>
	</query>

	<query name="holiday.getAll">
			<![CDATA[from org.mifos.application.holiday.business.HolidayBO holidayBO]]>
	</query>
	
	<sql-query name="holiday.applicableOffices">
	    <return-scalar column="office_name" type="string"/>
			select
			    office.display_name as office_name
			from holiday 
			    join office_holiday on holiday.holiday_id = office_holiday.holiday_id
			    join office on office_holiday.office_id = office.office_id
			    left join office as parent on office.parent_office_id = parent.office_id
			    left join office_holiday as parent_office_holiday on parent.office_id = parent_office_holiday.office_id
			    and parent_office_holiday.holiday_id = holiday.holiday_id
			    left join holiday as parent_holiday on parent_office_holiday.holiday_id = parent_holiday.holiday_id
			where
			    holiday.holiday_id = :HOLIDAY_ID
			    and
			    holiday.holiday_name != IFNULL(parent_holiday.holiday_name, '')
	</sql-query>
</hibernate-mapping>