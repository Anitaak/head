<?xml version="1.0" encoding="UTF-8"?>

<!-- This build file separates out the pmd target so that build.xml does not require a developer to have pmd installed. -->

<project name="mifos-pmd" default="pmd" basedir=".">

	<import file="build.xml"/>
	
	<property name="src.dir" value="${basedir}/src"/>
	<property name="pmd.dir" value="${basedir}/pmd"/>
	 

	<target name="cleanpmdreports" description="Cleans the PMD Report files">
		<delete>
			<fileset dir="${pmd.dir}/reports" includes="**/*.html"/>
			<fileset dir="${pmd.dir}/reports" includes="**/*.xml"/>
			<fileset dir="${pmd.dir}/reports" includes="**/*.txt"/>
			<fileset dir="${pmd.dir}/reports" includes="**/*.csv"/>
		</delete>
	</target>

	<target name="pmd" description="PMD Integration with BuildMifos.">
       	
			<!-- Fail this target if PMD is not installed. -->
       		<available file="${pmd.dir}/lib/pmd-4.1.jar" property="pmd.available"/>
       		<fail unless="pmd.available" message="Error: PMD_HOME not set or ${pmd-4.1.jar} not found."/>
       		<taskdef name="pmd" classname="net.sourceforge.pmd.ant.PMDTask">
          		<classpath>
             			<fileset dir="${pmd.dir}/lib">
                			<include name="*.jar"/>
             			</fileset>
          		</classpath>
       		</taskdef>

			<!-- Run PMD -->
       		<pmd rulesetfiles="basic" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_basic.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_basic.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_basic.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_basic.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_basic.html" />

	
		<pmd rulesetfiles="braces" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_braces.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_braces.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_braces.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	      	</pmd>
		<xslt in="pmd/reports/pmd_braces.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_braces.html" />


		<pmd rulesetfiles="clone" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_clone.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_clone.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_clone.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_clone.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_clone.html" />


		<pmd rulesetfiles="codesize" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_codesize.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_codesize.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_codesize.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_codesize.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_codesize.html" />

		
		<pmd rulesetfiles="coupling" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_coupling.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_coupling.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_coupling.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_coupling.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_coupling.html" />


		<pmd rulesetfiles="controversial" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_controversial.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_controversial.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_controversial.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_controversial.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_controversial.html" />

			
		<pmd rulesetfiles="design" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_design.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_design.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_design.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_design.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_design.html" />


		<pmd rulesetfiles="finalizers" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_finalizers.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_finalizers.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_finalizers.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_finalizers.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_finalizers.html" />



		<pmd rulesetfiles="imports" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_imports.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_imports.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_imports.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_imports.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_imports.html" />


		<pmd rulesetfiles="junit" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_junit.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_junit.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_junit.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_junit.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_junit.html" />


		<pmd rulesetfiles="logging-jakarta-commons" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_logging-jakarta-commons.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_logging-jakarta-commons.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_logging-jakarta-commons.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_logging-jakarta-commons.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_logging-jakarta-commons.html" />


		<pmd rulesetfiles="naming" shortFilenames="false" targetjdk="1.6">
		          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_naming.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_naming.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_naming.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_naming.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_naming.html" />


		<pmd rulesetfiles="strings" shortFilenames="false" targetjdk="1.6">
	  	          <formatter type="xml" toFile="${pmd.dir}/reports/pmd_strings.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_strings.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_strings.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_strings.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_strings.html" />


		<pmd rulesetfiles="unusedcode" shortFilenames="false" targetjdk="1.6">
 		         <formatter type="xml" toFile="${pmd.dir}/reports/pmd_unusedcode.xml" />
			  <formatter type="text" toFile="${pmd.dir}/reports/pmd_unusedcode.txt" />
			  <formatter type="csv" toFile="${pmd.dir}/reports/pmd_unusedcode.csv" />
			  <fileset dir="${src.dir}" includes="**/*.java" />
	       	</pmd>
		<xslt in="pmd/reports/pmd_unusedcode.xml" style="pmd/xslt/corley-pmd-report.xslt" out="pmd/reports/pmd_unusedcode.html" />

    	</target>

</project>
