<?xml version="1.0" encoding="UTF-8"?>
<!-- 
This build file separates out the jspc target so that build.xml
does not require a developer to have tomcat installed.

The jspc target compiles all the .jsp files, so that compile
errors can be found early.  Unless we do something of the
sort, we won't find them until someone tries to load that page.
-->

<project name="mifos-jspc" default="jspc" basedir=".">

	<import file="build.xml"/>

 	
	<target name="jspc" depends="compile, copy_files">
		<fail unless="tomcat.home">tomcat.home must be set</fail>
		<property name="webapp.path" value="${build.src.dir}"/>

		<path id="jspc.classpath">
			<pathelement location="${java.home}/../lib/tools.jar"/>
			<fileset dir="${tomcat.home}/bin">
				<include name="*.jar"/>
			</fileset>
			<fileset dir="${tomcat.home}/server/lib">
				<include name="*.jar"/>
			</fileset>
			<fileset dir="${tomcat.home}/common/lib">
				<include name="*.jar"/>
			</fileset>
		</path>

		<path id="war.classpath">
			<pathelement location="${webapp.path}/WEB-INF/classes"/>
			<fileset dir="${webapp.path}/WEB-INF/lib">
				<include name="*.jar"/>
			</fileset>
		</path>

		<pathconvert property="path.str" refid="war.classpath"/>

		<copy file="${src.dir}/org/mifos/META-INF/web.xml" todir="${webapp.path}/WEB-INF"/>
		
		<taskdef
		    classname="org.apache.jasper.JspC"
		    name="jasper2"
		    classpathref="jspc.classpath">
		</taskdef>

	<jasper2
            verbose="99"
            validateXml="false"
            uriroot="${webapp.path}"
            webXmlFragment="${webapp.path}/WEB-INF/generated_web.xml"
            outputDir="${webapp.path}/WEB-INF/src"
            classpath="${path.str}"
            caching="false"
        >
	</jasper2>
	</target>
</project>
