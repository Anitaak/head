<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >


<hibernate-mapping>

    <class name="org.mifos.application.checklist.business.CheckListBO" table="CHECKLIST">
        <id name="checklistId" column="CHECKLIST_ID" type="short">
            <generator class="native"/>
        </id>
 
        <property name="checklistName" column="CHECKLIST_NAME" type="string" />
        <property name="checklistStatus" column="CHECKLIST_STATUS" type="short"  not-null="true" />
        <property name="createdBy" column="CREATED_BY" type="short" />
        <property name="createdDate" column="CREATED_DATE" type="date" />
        <property name="updatedBy" column="UPDATED_BY" type="short" />
        <property name="updatedDate" column="UPDATED_DATE" type="date" />
 
        <many-to-one name="supportedLocales" column="LOCALE_ID" class="org.mifos.application.master.business.SupportedLocalesEntity"  not-null="true" lazy="true"/> 		
 		
        <set name="checklistDetailSet" table="CHECKLIST_DETAIL" cascade="all" order-by="DETAIL_ID asc" inverse="true">
            <key column="CHECKLIST_ID"/>
            <one-to-many class="org.mifos.application.checklist.business.CheckListDetailEntity"/>
        </set>		
		
		<joined-subclass name="org.mifos.application.checklist.business.CustomerCheckListBO" table="CUSTOMER_CHECKLIST">			
			<key column="CHECKLIST_ID" />			
			<many-to-one name="customerLevelEntity" column="LEVEL_ID" class="org.mifos.application.customer.business.CustomerLevelEntity" insert="true" update="true"  unique="true" lazy="true" not-null="true"/>
        	<many-to-one name="customerStatus" column="CUSTOMER_STATUS_ID" class="org.mifos.application.customer.business.CustomerStatusEntity"  not-null="true"  lazy="true"/>        			
		</joined-subclass>
		
		<joined-subclass name="org.mifos.application.checklist.business.AccountCheckListBO" table="PRD_CHECKLIST" >			
			<key column="CHECKLIST_ID" />						
		  	<many-to-one name="productTypeEntity" column="PRD_TYPE_ID" class="org.mifos.application.productdefinition.business.ProductTypeEntity" insert="true" update="true"  unique="true" lazy="true" not-null="true"/>
		  	<many-to-one name="accountStateEntity" column="ACCOUNT_STATUS" class="org.mifos.application.accounts.business.AccountStateEntity"  not-null="true" lazy="true" />        			
		</joined-subclass>
		
    </class>   
    
    <query name="account.statusChecklist">
   	       <![CDATA[select new org.mifos.application.checklist.util.valueobjects.CheckListMaster(accountCheckList.checklistId ,checkListDetail.detailText) 
   	       from  
   	       org.mifos.application.checklist.business.CheckListDetailEntity checkListDetail, 
   	       org.mifos.application.checklist.business.AccountCheckListBO  accountCheckList 
   	       
   	       where accountCheckList.checklistStatus=:checklistStatus 
   	       and accountCheckList.accountStateEntity.id=:accountStatus 
   	       and accountCheckList.productTypeEntity.productTypeID=:accountTypeId
   	       and accountCheckList.checklistId=checkListDetail.checkListBO.checklistId
   	       ]]>
     </query>    
       
</hibernate-mapping>
