<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >
<hibernate-mapping>
	<class name="org.mifos.application.productdefinition.business.PrdOfferingBO" table="PRD_OFFERING">
		<id name="prdOfferingId" column="PRD_OFFERING_ID" type="short">
			<generator class="native" />
		</id>
		<version name="versionNo" column="VERSION_NO" type="integer" unsaved-value="null" />
		<property name="globalPrdOfferingNum" column="GLOBAL_PRD_OFFERING_NUM" type="string" not-null="true" update="false" />
		<property name="startDate" column="START_DATE" type="date" not-null="true" />
		<property name="endDate" column="END_DATE" type="date" />
		<property name="prdOfferingName" column="PRD_OFFERING_NAME" type="string" />
		<property name="prdOfferingShortName" column="PRD_OFFERING_SHORT_NAME" type="string" not-null="true" />
		<property name="description" column="DESCRIPTION" type="string" />
		<property name="createdDate" column="CREATED_DATE" type="date" update="false" />
		<property name="createdBy" column="CREATED_BY" update="false" />
		<property name="updatedDate" column="UPDATED_DATE" type="date" />
		<property name="updatedBy" column="UPDATED_BY" />

		<many-to-one name="office" column="OFFICE_ID" class="org.mifos.application.office.business.OfficeBO" />
		<many-to-one name="prdCategory" column="PRD_CATEGORY_ID" class="org.mifos.application.productdefinition.business.ProductCategoryBO" cascade="none" />
		<many-to-one name="prdStatus" column="OFFERING_STATUS_ID" class="org.mifos.application.productdefinition.business.PrdStatusEntity" />
		<many-to-one name="prdType" column="PRD_TYPE_ID" class="org.mifos.application.productdefinition.business.ProductTypeEntity" />
		<many-to-one name="prdApplicableMaster" column="PRD_APPLICABLE_MASTER_ID" class="org.mifos.application.productdefinition.business.PrdApplicableMasterEntity" not-null="true" />

		<joined-subclass name="org.mifos.application.productdefinition.business.LoanOfferingBO" table="LOAN_OFFERING">
			<key column="PRD_OFFERING_ID" />
			<property name="minLoanAmount" column="MIN_LOAN_AMOUNT" type="double" not-null="true" />
			<property name="maxLoanAmount" column="MAX_LOAN_AMNT" type="double" not-null="true" />
			<property name="defaultLoanAmount" column="DEFAULT_LOAN_AMOUNT" type="double" />
			<property name="maxInterestRate" column="MAX_INTEREST_RATE" type="double" not-null="true" />
			<property name="minInterestRate" column="MIN_INTEREST_RATE" type="double" not-null="true" />
			<property name="defInterestRate" column="DEF_INTEREST_RATE" type="double" not-null="true" />
			<property name="maxNoInstallments" column="MAX_NO_INSTALLMENTS" type="short" not-null="true" />
			<property name="minNoInstallments" column="MIN_NO_INSTALLMENTS" type="short" not-null="true" />
			<property name="defNoInstallments" column="DEF_NO_INSTALLMENTS" type="short" not-null="true" />
			<property name="penaltyGrace" column="PENALTY_GRACE" type="short" not-null="true" />
			<property name="intDedDisbursementFlag" column="INT_DED_DISBURSEMENT_FLAG" type="short" />
			<property name="prinDueLastInstFlag" column="PRIN_DUE_LAST_INST_FLAG" type="short" />
			<property name="gracePeriodDuration" column="GRACE_PERIOD_DURATION" type="short" />
			<property name="penaltyRate" column="PENALTY_RATE" type="double" />
			<many-to-one name="gracePeriodType" column="GRACEPERIOD_TYPE_ID" class="org.mifos.application.productdefinition.business.GracePeriodTypeEntity" cascade="none" />
			<many-to-one name="interestTypes" column="INTEREST_TYPE_ID" class="org.mifos.application.master.business.InterestTypesEntity" not-null="true" />
			<many-to-one name="penalty" column="PENALTY_ID" class="org.mifos.application.penalty.util.valueobjects.Penalty" />
			<many-to-one name="interestCalcRule" column="INTEREST_CALC_RULE_ID" class="org.mifos.application.master.util.valueobjects.InterestCalcRule" />
			<many-to-one name="loanCounter" column="LOAN_COUNTER_FLAG" class="org.mifos.application.master.util.valueobjects.YesNoMaster" />
			<many-to-one name="principalGLcode" column="PRINCIPAL_GLCODE_ID" class="org.mifos.application.accounts.financial.business.GLCodeEntity" lazy="true" insert="true" update="false" />
			<many-to-one name="interestGLcode" column="INTEREST_GLCODE_ID" class="org.mifos.application.accounts.financial.business.GLCodeEntity" lazy="true" insert="true" update="false" />
			<many-to-one name="penaltyGLcode" column="PENALTIES_GLCODE_ID" class="org.mifos.application.accounts.financial.business.GLCodeEntity" lazy="true" insert="true" update="false" />

			<!--Mapping of loan offering to its associated funds-->
			<set name="loanOfferingFunds" cascade="all,delete-orphan" inverse="true" table="LOAN_OFFERING_FUND">
				<key column="PRD_OFFERING_ID" />
				<one-to-many class="org.mifos.application.productdefinition.business.LoanOfferingFundEntity" />
			</set>

			<set name="prdOfferingFees" cascade="all,delete-orphan" inverse="true" table="PRD_OFFERING_FEES">
				<key column="PRD_OFFERING_ID" />
				<one-to-many class="org.mifos.application.productdefinition.business.PrdOfferingFeesEntity" />
			</set>
			<one-to-one name="prdOfferingMeeting" class="org.mifos.application.productdefinition.business.PrdOfferingMeetingEntity" cascade="all" property-ref="prdOffering" />

		</joined-subclass>
		<joined-subclass name="org.mifos.application.productdefinition.business.SavingsOfferingBO" table="SAVINGS_OFFERING">
			<key column="PRD_OFFERING_ID" />

			<property name="interestRate" column="INTEREST_RATE" type="double" not-null="true" />
			<property name="recommendedAmount" type="org.mifos.framework.util.helpers.MoneyCompositeUserType">
				<column name="RECOMMENDED_AMOUNT_CURRENCY_ID" />
				<column name="RECOMMENDED_AMOUNT" />
			</property>
			<property name="maxAmntWithdrawl" type="org.mifos.framework.util.helpers.MoneyCompositeUserType">
				<column name="MAX_AMNT_WITHDRAWL_CURRENCY_ID" />
				<column name="MAX_AMNT_WITHDRAWL" />
			</property>
			<property name="minAmntForInt" type="org.mifos.framework.util.helpers.MoneyCompositeUserType">
				<column name="MIN_AMNT_FOR_INT_CURRENCY_ID" />
				<column name="MIN_AMNT_FOR_INT" />
			</property>

			<many-to-one name="recommendedAmntUnit" column="RECOMMENDED_AMNT_UNIT_ID" class="org.mifos.application.productdefinition.business.RecommendedAmntUnitEntity" cascade="none" />
			<many-to-one name="savingsType" column="SAVINGS_TYPE_ID" class="org.mifos.application.productdefinition.business.SavingsTypeEntity" not-null="true" />
			<many-to-one name="interestCalcType" column="INTEREST_CALCULATION_TYPE_ID" class="org.mifos.application.productdefinition.business.InterestCalcTypeEntity" not-null="true" />

			<many-to-one name="depositGLCode" column="DEPOSIT_GLCODE_ID" class="org.mifos.application.accounts.financial.business.GLCodeEntity" lazy="true" insert="true" update="false" access="field" />
			<many-to-one name="interestGLCode" column="INTEREST_GLCODE_ID" class="org.mifos.application.accounts.financial.business.GLCodeEntity" lazy="true" insert="true" update="false" access="field" />

			<set name="prdOfferingMeetings" cascade="all,delete-orphan" inverse="true" table="PRD_OFFERING_MEETING" lazy="true" access="field">
				<key column="PRD_OFFERING_ID" />
				<one-to-many class="org.mifos.application.productdefinition.business.PrdOfferingMeetingEntity" />
			</set>
		</joined-subclass>

	</class>
	<query name="loanOffering.getApplicableProduts">
		<![CDATA[from org.mifos.application.productdefinition.business.LoanOfferingBO loanOffering 
				where loanOffering.prdApplicableMaster.id = :prdApplicableMaster and 
				loanOffering.prdStatus.offeringStatusId = :prdStatus order by loanOffering.prdOfferingName]]>
	</query>
	<query name="product.maxprdofferingid">
		<![CDATA[select max(prd.prdOfferingId) 
		from org.mifos.application.productdefinition.business.PrdOfferingBO prd]]>
	</query>
	<query name="product.createofferingnamecount">
		<![CDATA[select count(*) 
		from org.mifos.application.productdefinition.business.PrdOfferingBO prd
		where prd.prdOfferingName=:prdOfferingName]]>
	</query>
	<query name="product.createofferingshortnamecount">
		<![CDATA[select count(*) 
		from org.mifos.application.productdefinition.business.PrdOfferingBO prd
		where prd.prdOfferingShortName=:prdOfferingShortName]]>
	</query>
	<query name="product.savingsapplicablerecurrencetypes">
		<![CDATA[from org.mifos.application.meeting.business.RecurrenceTypeEntity recType 
		where recType.recurrenceId=2 or recType.recurrenceId=3 
		order by recType.recurrenceName]]>
	</query>
</hibernate-mapping>
