<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >


<hibernate-mapping>

    <class name="org.mifos.application.accounts.util.valueobjects.AccountPayment" table="ACCOUNT_PAYMENT" mutable="false">
        <id name="paymentId" column="PAYMENT_ID" type="integer">
            <generator class="native"/>
        </id>
        
        <property name="accountId" column="ACCOUNT_ID" type="integer" />
        <property name="receiptNumber" column="RECEIPT_NUMBER" type="string"/>
        <property name="voucherNumber" column="VOUCHER_NUMBER" type="string"/>
        <property name="checkNumber" column="CHECK_NUMBER" type="string"/>
        <property name="bankName" column="BANK_NAME" type="string"/>
        <property name="paymentDate" column="PAYMENT_DATE" type="date"/>
        <property name="receiptDate" column="RECEIPT_DATE" type="date" not-null="true"/>
   		<property name="amount" type="org.mifos.framework.util.helpers.MoneyCompositeUserType">
		 <column name="CURRENCY_ID" /> 
		 <column name="AMOUNT" />
		</property>
     
        <many-to-one name="paymentType" column="PAYMENT_TYPE_ID" class="org.mifos.application.productdefinition.util.valueobjects.PaymentType"  cascade="none" update="false" insert="true"/>  
        
        <set name="accountTrxn" cascade="all" inverse="true" table="ACCOUNT_TRXN">
			<key column="PAYMENT_ID"  />			
			<one-to-many class="org.mifos.application.accounts.util.valueobjects.AccountTrxn"/>
		</set>
              
	</class>
	
	<query name="accountPayment.maxAccountPayment">
		<![CDATA[from org.mifos.application.accounts.util.valueobjects.AccountPayment accpayment
				where accpayment.paymentId = (select max(accountPayment.paymentId) 
				from org.mifos.application.accounts.util.valueobjects.AccountPayment accountPayment 
				where accountPayment.accountId = :accountId)
				]]>
	  </query>
</hibernate-mapping>