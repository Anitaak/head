<?xml version="1.0" encoding='UTF-8'?>
<!DOCTYPE hibernate-mapping PUBLIC
                            "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
                            "http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd" >


<hibernate-mapping>

	<class name="org.mifos.application.office.business.OfficeBO" table="OFFICE">
		<id name="officeId" column="OFFICE_ID" type="short">
			<generator class="native" />
		</id>
		<version name="versionNo" column="VERSION_NO" type="integer" />
		<property name="searchId" column="SEARCH_ID" type="string" />
		<property name="officeName" column="DISPLAY_NAME" type="string" />
		<property name="createdDate" column="CREATED_DATE" type="date" />
		<property name="updatedDate" column="UPDATED_DATE" type="date" />
		<property name="globalOfficeNum" column="GLOBAL_OFFICE_NUM"	type="string" />
		<property name="maxChildCount" column="MAX_CHILD_COUNT"	type="integer" />
		<property name="operationMode" column="LOCAL_REMOTE_FLAG"  />
		<property name="createdBy" column="CREATED_BY" />
		<property name="updatedBy" column="UPDATED_BY" />
		<property name="shortName" column="OFFICE_SHORT_NAME" type="string" />
		
		 <many-to-one name="level" class="org.mifos.application.office.business.OfficeLevelEntity" column="OFFICE_LEVEL_ID" unique="true" insert="true" update="true" />
		<many-to-one name="parentOffice" class="org.mifos.application.office.business.OfficeBO"	column="PARENT_OFFICE_ID" unique="true" insert="true" update="true"	lazy="true" cascade="none" />
		<many-to-one name="status"	class="org.mifos.application.office.business.OfficeStatusEntity" column="STATUS_ID" unique="true" insert="true" update="true"	lazy="true" />
		<set name="customFields" cascade="all" inverse="true"  table="OFFICE_CUSTOM_FIELD">
			<key column="OFFICE_ID" />
			<one-to-many class="org.mifos.application.office.business.OfficeCustomFieldEntity" />
		</set>

		<one-to-one name="address"	class="org.mifos.application.office.business.OfficeAddressEntity"	cascade="all" property-ref="office" lazy="true" />
	</class>
	<query name="masterdata.activeBranches">
        <![CDATA[select new org.mifos.application.office.business.OfficeView(office.officeId, office.officeName,office.level.levelId,office.versionNo) from org.mifos.application.office.business.OfficeBO office where office.level.levelId=:levelId and office.status.statusId=:statusId and (office.searchId = :OFFICESEARCHID or office.searchId like :OFFICE_LIKE_SEARCHID) order by office.officeName]]>
    </query>
    <query name="office.getOfficeSearchId">
            <![CDATA[select office.searchId from org.mifos.application.office.business.OfficeBO office where office.officeId = :OFFICE_ID]]>
    </query>
    <query name="office.getAllOffices">
            <![CDATA[select new org.mifos.framework.security.util.OfficeCacheView(office.officeId, office.parentOffice.officeId, office.searchId) from org.mifos.application.office.business.OfficeBO office]]>
    </query>
    
     <query name="office.getHeadOffice">
            <![CDATA[from org.mifos.application.office.business.OfficeBO office where office.level.levelId = :LEVEL_ID]]>
    </query>
</hibernate-mapping>